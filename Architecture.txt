ReadMe: Nonprofits Twitter Analysis 

This file builds provides some information on 

goes through setp by step instructions to run this application. Comments and instrcution lines are denoted with ` and commands or inputs for cmd are denoted by $.

Step 1: Logging In and Root Installs

	`Log into AWS and lauch EC2 instance and attach EBS volume. 

	`Find location of EBS volumn: fdisk -l
	`Mount disk volumne (default /dev/xvdf): 
	$mount -t ext4 /dev/path /data 

	`Make sure Github is installed and the appropriate directory is pulled (ashley-dsci/w205_TurnIn/exercise_2)
	`Key files will be copied from here later on
	`In order to have the filepaths consistent with commands below
	`pull the exercise_2 directory into the folder /data/ex2/

	Start up key processes
		`Install lein as required by streamparse
		wget --directory-prefix=/usr/bin/ https://raw.githubusercontent.com/technomancy/leiningen/stable/bin/lein
		chmod a+x /usr/bin/lein
		sudo /usr/bin/lein

		`start hadoop: 
		$/root/start-hadoop.sh 
		
		`start postgres: 
		$/data/start_postgres.sh

		`move the current python version: 
		$mv /usr/bin/python /usr/bin/python266

		`change to w205 user: 
		$su - w205


Step 2: Installation & Configuration from w205 user

	We will be using anaconda to manage the python packages, anaconda needs to be installed as teh w205 user to be able to have the correct permissions when running the scripts. 

	Anaconda: 
		`Get the correct anaconda version:
		$wget https://repo.continuum.io/archive/Anaconda2-4.1.1-Linux-x86_64.sh
		
		`install anaconda and follow promts to install 
		$bash Anaconda2-4.1.1-Linux-x86_64.sh
		
		`set anaconda's python as default
		`Anaconda install will ask to prepend to PATH /home/w205/anaconda2 - press enter/yes
		$yes
		
		`check python version, if not 2.7.12 use code below to set the default
		$python --version

		`use the commands below from root to set link and default python version and return to w205 user`
		`(default placement /home/w205/anaconda2)
		$ln -s /path/to/anaconda/bin/python /usr/bin/python 
		$export PATH=/home/w205/anaconda2/bin:$PATH
		$python --version


	Psycopg2: 
	`install psycopg2 and follow promts
	$conda install psycopg2


	Streamparse: 
		`anacnoda includes pip, virtualenv, easy_install`
		`update pip to avoid warning messages`
		$conda update pip
		
		`install streamparse
		$pip install streamparse

	Tweepy: 
		`install tweepy
		$pip install tweepy


Step 3: Set Up Postgres

	`create the postgres database
	$psql --username=postgres

	`now we will create a new database using the following SQL commands

	CREATE USER w205 WITH PASSWORD 'postgres';
	DROP DATABASE Tcount;
	CREATE DATABASE Tcount;
	ALTER DATABASE Tcount OWNER TO w205;
	GRANT ALL ON DATABASE Tcount TO w205;

	`check the databases lists to ensure tcount is there
	$postgres=# \l

	`quit postgres
	$\q

	`log into the Tcount database
	$psql --host=localhost --username=w205 --password --dbname=tcount
	`it will promt for a password
	`Password for user w205: (hit enter - no password)
	$

	`create table Tweetwordcount (note first we drop the table in case it already existed)
	`use the following sql commands (note do not copy the tab before CREATE)
	
	DROP TABLE Tweetwordcount
	CREATE TABLE Tweetwordcount(word TEXT PRIMARY KEY NOT NULL, count INT NOT NULL);

	`check to make sure table was created
	$tcount=> \d

	`quit postgres and return to w205 user
	$\q


Step 4: Execution

	`From the w205 user
	`launch a storm instanace Tweetwordcount
	`Note cannot include number in the streamparse filepath (ie EX2... throws an error)
	$sparse quickstart Tweetwordcount

	`move the files pulled from Github (should be pulled into /data/ex2) 
	`to the correct file locations in Tweetwordcount (bolts, spout, topoligies)
	$cp /data/ex2/tweetwordcount/tweetwordcount.clj  /home/w205/Tweetwordcount/topologies/tweetwordcount.clj 
	$rm /home/w205/Tweetwordcount/topologies/wordcount.clj
	$cp /data/ex2/tweetwordcount/tweets.py /home/w205/Tweetwordcount/src/spouts/tweets.py
	$cp /data/ex2/tweetwordcount/parse.py  /home/w205/Tweetwordcount/src/bolts/parse.py 
	$cp -f /data/ex2/tweetwordcount/wordcount.py  /home/w205/Tweetwordcount/src/bolts/wordcount.py


	`change to the tweetwordcount directory
	cd Tweetwordcount

	`run the application
	sparse run

	`Note: there is not timeout time given, so the application will continue to run
	`use cntrl+c or other keystroke to stop the application
	(CRTL + c)

	`return to the w205 directory
	`cd ..

Step 5: Analysis
	`copy the analysis files to the users directories
	$cp -R /data/ex2/analysis/* /home/w205/

	`run the finalresults.py file with word or without
	$python finalresults.py

	`run the histogram.py file with two given values k1 k2
	$python histogram.py k1 k2

	`plot.png is already created in the github folder, but can be regenerated using the plot.py file
	$python plot.py